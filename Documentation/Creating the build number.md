### Creating the STAC Software Build Number

If you're not modifying the STAC software, you can ignore this document.

When in the throws of development and working with multiple ATOM units, sometimes I get lost as to which version of software is actually running on which unit. I could increment the `swVer` variable in the `STAC.ino` file every time I change something there or in any file in the `STACLib` folder but that means remembering to keep some other log file or such. So here's something new I'm trying out to hopefully deconfuse what version of software is actually running on the STAC.

In the `STAC.ino` file there is this line:

```
String swVer = "2.0 (1a2b3c)";    // version and (build number) of this software. Shows up on the web config page, serial monitor startup data dump & is stored in NVS
```

The string of six characters between the brackets is the build number. (`1a2b3c` is an example build number.)

It is generated by doing an MD5 hash of all the contents of the `STAC` folder and using the last six characters of that hash for the build number.

The utility that creates the hash is `hashdir`. Found on GitHub at:

`https://github.com/ultimateanu/hashdir`
    
and installed using Homebrew by:

`brew install ultimateanu/software/hashdir`


To generate the build number, from Terminal run:

`hashdir -a md5 <folder>`
 
Where `<folder>` is the folder that contains only the `STAC.ino` file and the `STACLib` folder.

For example:

`hashdir -a md5 ~/Documents/SmartTallyAtomClient/STAC`

will produce something like:

`9c5d0c5114fab7a3f6b0770bd10bbefe  /STAC`

In this example, `0bbefe` would be the build number for this version of STAC.

**BUT** before you generate the hash, first edit the line:

    `String swVer = "2.0 (1a2b3c)";    // version and (build number) of this software. Shows up on the web config page, serial monitor startup data dump & is stored in NVS`

to remove the old build number so that it looks like this:

    `String swVer = "2.0 ()";    // version and (build number) of this software. Shows up on the web config page, serial monitor startup data dump & is stored in NVS`
    
Then save the `STAC.ino` file and any other file that might be open from the `STACLib` foder.

Now create and save the new build number:

1. Generate the hash
1. Copy the last six characters of the hash from the Terminal window - this is the new build number
1. Open the `STAC.ino` file
1. Paste the new build number in between the brackets on the line:

      ```
      String swVer = "2.0 ()";    // version and (build number) of this software. Shows up on the web config page, serial monitor startup data dump & is stored in NVS
      ```
 
   so it now looks like:
 
       ```
       String swVer = "2.0 (0bbefe)";    // version and (build number) of this software. Shows up on the web config page, serial monitor startup data dump & is stored in NVS
       ```
     
5. Save the STAC.ino file
6. Safe now to upload to the ATOM Matrix

*Why delete the old build number before doing the hash?*

By making note of the existing build number in the `STAC.ino` file, deleting the build number and then generating the hash, a quick check can be made if this version of the `STAC.ino` file and its associated `STACLib` `.h` files are the same as a version running on an ATOM. Delete the existing build number from the `STAC.ino` file, generate the hash, look at and compare the last six digits of the hash to the build number reported by the serial data dump from the STAC. If they match, odds are strong you're good.

**Xylopyrographer**<br>
  2022-08-05
